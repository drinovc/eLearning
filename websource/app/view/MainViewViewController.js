/*
 * File: app/view/MainViewViewController.js
 *
 * This file was generated by Sencha Architect version 4.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('eLearning.view.MainViewViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.mainview',

    load: function() {
        this.loadLookups();
    },

    getAjax: function(url, params, name) {
        /*
        Ext.Ajax.request({
            url: 'feed.json',
        }).then(function(response) {
            // use response
        }).always(function() {
           // clean-up logic, regardless the outcome
        }).otherwise(function(reason){
           // handle failure
        });
        */

        return new Ext.Promise(function (resolve, reject) {
            Ext.Ajax.request({
                url: url,
                params: params,
                success: function (response) {
                    var rObj = Ext.decode(response.responseText || '{}');

                    if(rObj.success) {
                        resolve({
                            name: name,
                            data: rObj.data,
                        });
                    }
                    else {
                        reject(rObj.reason || 'Success false');
                    }
                },
                failure: function (response) {
                    reject(response.status);
                }
            });
        });
    },

    loadLookups: function() {
        var me = this;

        Ext.Promise.all([
            me.getAjax('/Lookups/ProgramCategories', {}, 'ProgramCategories'),
            me.getAjax('/Lookups/ProgramPageCategories', {}, 'ProgramPageCategories'),
            me.getAjax('/Lookups/CoursesAndCertificates', {}, 'CoursesAndCertificates'),
            me.getAjax('/Lookups/ProgramStatuses', {}, 'ProgramStatuses')
        ]).then(function(data) {
            Ext.each(data, function(data) {
                App.lookups[data.name] = data.data;
            });

            // Getting ProgramPageCategories into enum where key is text ('Chapter', 'Page') and value is id (1, 2)
            App.ProgramPageCategoriesEnum = {};
            for(var i = 0; i < App.lookups.ProgramPageCategories.length; i++){
                var obj = App.lookups.ProgramPageCategories[i];
                App.ProgramPageCategoriesEnum[obj.text] = obj.id;
            }
            Object.freeze(App.ProgramPageCategoriesEnum); // freezing enum so it cannot be changed later





        }, function(err) {
            Ext.Msg.alert('Load Lookups Error', err);
        });
    },

    onMainViewBoxReady: function(component, width, height, eOpts) {
        this.load();
    }

});
